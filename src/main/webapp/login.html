<!DOCTYPE html>
<html lang="ko">
<head>
<title>조상사랑 - 예초 벌초 매칭 서비스</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon.png">
<style>
body, h1, h2, h3, h4, h5, h6 {
	font-family: "Lato", sans-serif
}

.w3-bar, h1, button {
	font-family: "Lato", sans-serif
}

.container {
	width: 300px;
	margin: 0 auto;
	padding: 20px;
	border: 1px solid #ccc;
	border-radius: 10px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	text-align: left;
}

.container h1 {
	text-align: center;
}

label {
	display: block;
	margin-bottom: 10px;
	font-weight: bold;
}

input[type="text"], input[type="password"], input[type="date"] {
	width: 100%;
	padding: 10px;
	margin-bottom: 20px;
	border: 1px solid #ccc;
	border-radius: 5px;
	box-sizing: border-box;
}

.button-container {
	display: flex;
	justify-content: space-between;
	gap: 10px;
}

.button-container button {
	flex: 1;
	padding: 10px;
	background-color: #4CAF50;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}

.button-container button:hover {
	background-color: #45a049;
}

.modal {
	display: none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
	background-color: #fefefe;
	margin: 5% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%;
	max-width: 500px;
	border-radius: 10px;
	position: relative;
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
}

.close {
	position: absolute;
	right: 10px;
	top: 5px;
	color: #aaa;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}

.clearfix::after {
	content: "";
	clear: both;
	display: table;
}

.cancelbtn, .signupbtn {
	width: 48%;
	padding: 10px;
	border: none;
	border-radius: 5px;
	cursor: pointer;
	font-size: 16px;
}

.cancelbtn {
	background-color: #f44336;
	color: white;
	float: left;
}

.signupbtn {
	background-color: #4CAF50;
	color: white;
	float: right;
}

.modal-content .container {
	width: 100%;
	padding: 0;
	margin: 0;
	box-shadow: none;
	border: none;
}

.gender-selection {
	display: flex;
	justify-content: space-around;
	margin-bottom: 20px;
}

.gender-selection label {
	display: inline-flex;
	align-items: center;
}

.gender-selection input[type="radio"] {
	margin-right: 5px;
}

@media screen and (max-width: 300px) {
	.cancelbtn, .signupbtn {
		width: 100%;
	}
}

.footer {
    position: relative;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    background-color: #f1f1f1; 
}

</style>
</head>
<body>
	<!-- 네비게이션 바 -->
	<div class="w3-top">
		<div class="w3-bar w3-light-green w3-card w3-left-align w3-large">
			<a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red"
				href="javascript:void(0);" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a> 
				<a href="index.html" class="w3-bar-item w3-button w3-padding-large w3-green">뒤로가기</a>
		</div>

		<!-- 네비게이션 바 on small screens -->
		<div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
		</div>
	</div>

    <!-- 로그인 창 -->
    <div class="w3-row-padding w3-light-grey w3-padding-64 w3-container w3-center">
        <div class="container">
            <h1>로그인</h1>
            
            <div class="radio-selection">
                <label><input type="radio" name="loginType" value="user" checked> 회원</label>
                <label><input type="radio" name="loginType" value="partner"> 파트너</label>
            </div>

            <form id="loginForm">
                <label for="email"><b>이메일</b></label>
                <input type="text" placeholder="Enter Email" id="email" name="email" required>
                
                <label for="psw"><b>비밀번호</b></label>
                <input type="password" placeholder="Enter Password" id="password" name="password" required>

                <div class="button-container">
                    <button type="submit" class="loginbtn">로그인</button>
                    <button type="button" class="signupbtn" id="openSignupModal">회원가입</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 회원가입 모달 -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>회원가입</h2>
            <div class="radio-selection">
                <label><input type="radio" name="signupType" value="user" checked> 회원</label>
                <label><input type="radio" name="signupType" value="partner"> 파트너</label>
            </div>

            <!-- 유저 회원가입 폼 -->
            <form id="userSignupForm">
                <label for="name"><b>이름</b></label>
                <input type="text" placeholder="Enter Name" name="userName" required>

                <label for="signupEmail"><b>이메일</b></label>
                <input type="text" placeholder="Enter Email" name="userEmail" required>

                <label for="signupPassword"><b>비밀번호</b></label>
                <input type="password" placeholder="Enter Password" name="userPw" required>

                <label for="age"><b>나이</b></label>
                <input type="number" min="0" placeholder="Enter Age" name="userAge" required>

                <label for="gender"><b>성별</b></label>
                <div class="radio-selection">
                    <label><input type="radio" name="userGender" value="male" required> 남성</label>
                    <label><input type="radio" name="userGender" value="female" required> 여성</label>
                </div>

                <button type="submit" class="loginbtn">회원가입</button>
            </form>

            <!-- 파트너 회원가입 폼 -->
            <form id="partnerSignupForm" style="display:none;">
                <label for="name"><b>이름</b></label>
                <input type="text" placeholder="Enter Name" name="partnerName" required>

                <label for="signupEmail"><b>이메일</b></label>
                <input type="text" placeholder="Enter Email" name="partnerEmail" required>

                <label for="signupPassword"><b>비밀번호</b></label>
                <input type="password" placeholder="Enter Password" name="partnerPw" required>

                <button type="submit" class="loginbtn">회원가입</button>
            </form>
        </div>
    </div>

    <script>
        // 로그인 폼 제출 처리
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();

            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;
            var loginType = document.querySelector('input[name="loginType"]:checked').value;

            if (!email || !password) {
                alert('이메일과 비밀번호를 입력하세요.');
                return;
            }

            var requestBody = {};
            var url = "";
            if (loginType === "user") {
                requestBody.userEmail = email;
                requestBody.userPw = password;
                url = "/userLogin";
            } else {
                requestBody.partnerEmail = email;
                requestBody.partnerPw = password;
                url = "/partnerLogin";
            }

            fetch(url, {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestBody),
                credentials: 'include' // 쿠키를 포함하여 요청을 보냄
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('서버 응답 실패');
                }
                return response.json();  
            })
           .then(data => {
                if (data.message === "로그인 성공") {
                    alert('로그인 성공');
                    // 세션 정보를 로컬 스토리지에 저장
                    if (loginType === "user") {
                        sessionStorage.setItem('userInfo', JSON.stringify({
                            id: data.id,
                            name: data.name,
                            type: 'user'
                        }));
                    } else {
                        sessionStorage.setItem('partnerInfo', JSON.stringify({
                            id: data.id,
                            name: data.name,
                            type: 'partner'
                        }));
                    }
                    // 홈페이지로 리다이렉트
                    window.location.href = '/';
                } else {
                    alert('로그인 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('로그인 중 오류 발생: ' + error.message);
            });
        });

        // 모달 관련 코드
        var signupModal = document.getElementById('signupModal');
        var openSignupModalBtn = document.getElementById('openSignupModal');
        var closeSignupModalBtn = document.getElementsByClassName('close')[0];

        openSignupModalBtn.onclick = function() {
            signupModal.style.display = "block";
            updateSignupForm();
        }

        closeSignupModalBtn.onclick = function() {
            signupModal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == signupModal) {
                signupModal.style.display = "none";
            }
        }

        // 회원가입 폼 업데이트
        const updateSignupForm = () => {
            const signupType = document.querySelector('input[name="signupType"]:checked').value;
            document.getElementById('userSignupForm').style.display = (signupType === 'user') ? 'block' : 'none';
            document.getElementById('partnerSignupForm').style.display = (signupType === 'partner') ? 'block' : 'none';
        }

        document.querySelectorAll('input[name="signupType"]').forEach(el => {
            el.addEventListener('change', updateSignupForm);
        });

        // 유저 회원가입 폼 제출 처리
        document.getElementById('userSignupForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var userName = document.getElementsByName('userName')[0].value;
            var userEmail = document.getElementsByName('userEmail')[0].value;
            var userPw = document.getElementsByName('userPw')[0].value;
            var userAge = document.getElementsByName('userAge')[0].value;
            var userGender = document.querySelector('input[name="userGender"]:checked').value;

            if (!userName || !userEmail || !userPw || !userAge || !userGender) {
                alert('모든 필드를 입력하세요.');
                return;
            }

            fetch('/userSignup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userName: userName,
                    userEmail: userEmail,
                    userPw: userPw,
                    userAge: parseInt(userAge),
                    userGender: userGender.toUpperCase()
                })
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                signupModal.style.display = "none";
            })
            .catch(error => {
                console.error('Error:', error);
                alert('회원가입 중 오류 발생: ' + error.message);
            });
        });

        // 파트너 회원가입 폼 제출 처리
        document.getElementById('partnerSignupForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var partnerName = document.getElementsByName('partnerName')[0].value;
            var partnerEmail = document.getElementsByName('partnerEmail')[0].value;
            var partnerPw = document.getElementsByName('partnerPw')[0].value;

            if (!partnerName || !partnerEmail || !partnerPw) {
                alert('모든 필드를 입력하세요.');
                return;
            }

            fetch('/partnerSignup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    partnerName: partnerName,
                    partnerEmail: partnerEmail,
                    partnerPw: partnerPw
                })
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                signupModal.style.display = "none";
            })
            .catch(error => {
                console.error('Error:', error);
                alert('회원가입 중 오류 발생: ' + error.message);
            });
        });
    </script>

    <footer class="w3-container w3-padding-16 w3-center w3-opacity footer">
        <div class="w3-xlarge"></div>
        <p>Powered by <a href="https://github.com/LeeYeonhee-00/AncestorLove" target="_blank">체큇아웃</a></p>
    </footer>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<html>
<head>
<title>Partner List</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body, h1, h2, h3, h4, h5, h6 {
	font-family: "Raleway", sans-serif;
}

.header-container {
	padding-top: 70px;
} /* Adjust this value if necessary */
.partner-card {
	background-color: #f1f1f1; /* Card background color */
	padding: 20px;
	border-radius: 10px;
	margin-bottom: 20px;
}

.partner-card img {
	width: 100%; /* Increase the image width to fill container */
	max-width: 500px; /* Increase the maximum width */
	height: auto;
	margin-bottom: 20px;
	border-radius: 10px;
}

.partner-card h3 {
	margin-bottom: 10px;
}

.partner-card p {
	margin: 10px 0;
}
</style>
</head>
<body>

	<!-- Navbar -->

	<div class="w3-top">
		<div class="w3-bar w3-light-green w3-card w3-left-align w3-large">
			<a
				class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-red"
				href="javascript:void(0);" title="Toggle Navigation Menu"> <i
				class="fa fa-bars"></i>
			</a> <a href="main.html"
				class="w3-bar-item w3-button w3-padding-large w3-hover-white w3-green">Home</a>
			<a href="list.html"
				class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">의뢰하기</a>
			<a href="partner.html"
				class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white">파트너</a>
			<div id="loginSection" class="w3-right">
				<!-- 로그인/로그아웃 버튼이 여기에 동적으로 삽입됩니다 -->
			</div>
		</div>

		<!-- Navbar on small screens -->
		<div id="navDemo"
			class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium w3-large">
		</div>
	</div>

	<!-- Header -->
	<header id="PartnerList" class="header-container">
		<div class="w3-container">
			<h1>
				<b>제휴 파트너 리스트</b>
			</h1>
		</div>
	</header>

	<!-- Partner List -->
	<div class="w3-row-padding">
		<!-- Partner cards will be inserted here -->
	</div>

	<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/allpartner')
        .then(response => response.json())
        .then(partners => {
            const partnerList = document.querySelector('.w3-row-padding');
            partnerList.innerHTML = ''; // 기존 내용 삭제

            partners.forEach(partner => {
                const partnerCard = createPartnerCard(partner);
                partnerList.appendChild(partnerCard);
            });
        })
        .catch(error => console.error('Error fetching partners:', error)); // 오류 메시지를 명확하게 변경
});

function createPartnerCard(partner) {
    const card = document.createElement('div');
    card.className = 'w3-col l4 m12';
    card.innerHTML = `
        <div class="partner-card w3-card-2">
            <img src="images/yecho.jpg" alt="${partner.partnerName}"> <!-- 이미지 경로 수정 가능 -->
            <h3><a href="partnerdetail.html?id=${partner.partnerId}">${partner.partnerName}</a></h3>
            <p>작업 지역: ${partner.partnerLocation}</p>
            <p>평점: ${renderStars(partner.averageRating)}</p>
        </div>
    `;
    return card;
}

function renderStars(rating) {
    const fullStars = Math.floor(rating);
    const halfStar = rating % 1 >= 0.5 ? 1 : 0;
    const emptyStars = 5 - fullStars - halfStar;

    return '★'.repeat(fullStars) + (halfStar ? '½' : '') + '☆'.repeat(emptyStars);
}


// 로그인 상태 확인 및 UI 업데이트 함수
function updateLoginUI() {
    const user = JSON.parse(localStorage.getItem('user'));
    const loginSection = document.getElementById('loginSection');
    const smallScreenLogin = document.getElementById('smallScreenLogin');

    if (user && user.name) {
        loginSection.innerHTML = `
            <a class="w3-bar-item w3-hide-small w3-padding-large">${user.name}님 환영합니다</a>
            <a onclick="logout()" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white w3-green">로그아웃</a>
        `;
        if (smallScreenLogin) {
            smallScreenLogin.textContent = "로그아웃";
            smallScreenLogin.onclick = logout;
        }
    } else {
        loginSection.innerHTML = `
            <a href="login.html" class="w3-bar-item w3-button w3-hide-small w3-padding-large w3-hover-white w3-green">로그인</a>
        `;
        if (smallScreenLogin) {
            smallScreenLogin.textContent = "로그인";
            smallScreenLogin.onclick = null;
            smallScreenLogin.href = "login.html";
        }
    }
}

//로그아웃 함수
function logout() {
localStorage.removeItem('user');
updateLoginUI();
alert('로그아웃이 완료되었습니다.'); 
window.location.href = 'main.html';
// logout api 추가하기
}

//페이지 로드 시 로그인 UI 업데이트
document.addEventListener('DOMContentLoaded', updateLoginUI);

</script>

</body>
</html>
